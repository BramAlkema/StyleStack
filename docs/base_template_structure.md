# Base Template Structure with Embedded Carriers

> **Key Insight**: All OOXML structures must be **pre-embedded in base templates** with `{{carrier.property.value_emu}}` placeholders, **not** generated by a patcher.

This document shows how StyleStack base templates (.potx, .dotx, .xltx) should be structured with embedded carrier variables that get resolved at build time.

## **Template Architecture**

```
templates/
├── microsoft/
│   ├── presentation.potx          # PowerPoint template with embedded carriers
│   ├── document.dotx              # Word template with embedded carriers  
│   └── spreadsheet.xltx           # Excel template with embedded carriers
├── libreoffice/
│   ├── presentation.otp           # LibreOffice Impress with carriers
│   ├── document.ott               # LibreOffice Writer with carriers
│   └── spreadsheet.ots            # LibreOffice Calc with carriers
└── google/
    ├── presentation.json          # Google Slides template data
    ├── document.json              # Google Docs template data  
    └── spreadsheet.json           # Google Sheets template data
```

---

## **PowerPoint Base Template (.potx) Structure**

### File: `templates/microsoft/presentation.potx`

The .potx file is a ZIP containing these parts with embedded carriers:

### **[Content_Types].xml**
```xml
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml" ContentType="application/xml"/>
  <Override PartName="/ppt/presentation.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml"/>
  <Override PartName="/ppt/slideMasters/slideMaster1.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.slideMaster+xml"/>
  <Override PartName="/ppt/slideLayouts/slideLayout1.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.slideLayout+xml"/>
  <Override PartName="/ppt/slides/slide1.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.slide+xml"/>
  <Override PartName="/ppt/theme/theme1.xml" ContentType="application/vnd.openxmlformats-officedocument.theme+xml"/>
  <Override PartName="/ppt/tableStyles.xml" ContentType="application/vnd.openxmlformats-officedocument.presentationml.tableStyles+xml"/>
</Types>
```

### **ppt/presentation.xml** (with slide size carriers)
```xml
<p:presentation xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main"
                xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" 
                xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main">
  
  <!-- CARRIER: Slide dimensions -->
  <p:sldSz cx="{{presentation.slide.width_emu}}" cy="{{presentation.slide.height_emu}}" type="screen16x9"/>
  <p:notesSz cx="{{presentation.notes.width_emu}}" cy="{{presentation.notes.height_emu}}"/>

  <p:sldMasterIdLst>
    <p:sldMasterId r:id="rIdMaster1"/>
  </p:sldMasterIdLst>

  <p:sldIdLst>
    <p:sldId id="256" r:id="rIdSlide1"/>
  </p:sldIdLst>

  <!-- CARRIER: Default text fallbacks -->
  <p:defaultTextStyle>
    <a:defPPr>
      <a:defRPr sz="{{typography.default.size_emu}}" lang="{{typography.default.lang}}"/>
    </a:defPPr>
  </p:defaultTextStyle>
</p:presentation>
```

### **ppt/theme/theme1.xml** (with embedded theme carriers)
```xml
<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="StyleStack Theme">
  <a:themeElements>
    <!-- CARRIERS: Color scheme -->
    <a:clrScheme name="StyleStack Colors">
      <a:dk1><a:srgbClr val="{{theme.color.dk1}}"/></a:dk1>
      <a:lt1><a:srgbClr val="{{theme.color.lt1}}"/></a:lt1>
      <a:dk2><a:srgbClr val="{{theme.color.dk2}}"/></a:dk2>
      <a:lt2><a:srgbClr val="{{theme.color.lt2}}"/></a:lt2>
      <a:accent1><a:srgbClr val="{{theme.color.accent1}}"/></a:accent1>
      <a:accent2><a:srgbClr val="{{theme.color.accent2}}"/></a:accent2>
      <a:accent3><a:srgbClr val="{{theme.color.accent3}}"/></a:accent3>
      <a:accent4><a:srgbClr val="{{theme.color.accent4}}"/></a:accent4>
      <a:accent5><a:srgbClr val="{{theme.color.accent5}}"/></a:accent5>
      <a:accent6><a:srgbClr val="{{theme.color.accent6}}"/></a:accent6>
      <!-- CRITICAL CARRIERS: Hyperlink colors -->
      <a:hlink><a:srgbClr val="{{theme.color.hlink}}"/></a:hlink>
      <a:folHlink><a:srgbClr val="{{theme.color.folHlink}}"/></a:folHlink>
    </a:clrScheme>

    <!-- CARRIERS: Font scheme -->
    <a:fontScheme name="StyleStack Fonts">
      <a:majorFont>
        <a:latin typeface="{{theme.font.major.latin}}"/>
        <a:ea typeface="{{theme.font.major.ea}}"/>
        <a:cs typeface="{{theme.font.major.cs}}"/>
      </a:majorFont>
      <a:minorFont>
        <a:latin typeface="{{theme.font.minor.latin}}"/>
        <a:ea typeface="{{theme.font.minor.ea}}"/>
        <a:cs typeface="{{theme.font.minor.cs}}"/>
      </a:minorFont>
    </a:fontScheme>

    <!-- CARRIERS: Format scheme with background fills -->
    <a:fmtScheme name="StyleStack Effects">
      <a:fillStyleLst>
        <a:solidFill><a:schemeClr val="lt1"/></a:solidFill>
        <a:gradFill rotWithShape="1">
          <a:gsLst>
            <a:gs pos="0"><a:schemeClr val="lt1"/></a:gs>
            <a:gs pos="100000"><a:schemeClr val="dk1"/></a:gs>
          </a:gsLst>
          <a:lin ang="2700000" scaled="1"/>
        </a:gradFill>
        <a:gradFill rotWithShape="1">
          <a:gsLst>
            <a:gs pos="0"><a:schemeClr val="accent1"><a:tint val="50000"/></a:schemeClr></a:gs>
            <a:gs pos="100000"><a:schemeClr val="accent1"><a:shade val="50000"/></a:schemeClr></a:gs>
          </a:gsLst>
        </a:gradFill>
      </a:fillStyleLst>
      
      <!-- CRITICAL CARRIERS: Background fill styles -->
      <a:bgFillStyleLst>
        <a:solidFill><a:schemeClr val="lt1"/></a:solidFill>
        <a:gradFill rotWithShape="1">
          <a:gsLst>
            <a:gs pos="0"><a:schemeClr val="lt1"/></a:gs>
            <a:gs pos="100000"><a:schemeClr val="lt2"/></a:gs>
          </a:gsLst>
          <a:lin ang="5400000" scaled="1"/>
        </a:gradFill>
        <a:solidFill><a:schemeClr val="dk1"><a:tint val="95000"/></a:schemeClr></a:solidFill>
      </a:bgFillStyleLst>
      
      <a:lnStyleLst>
        <a:ln w="9525"><a:solidFill><a:schemeClr val="accent1"/></a:solidFill></a:ln>
        <a:ln w="19050"><a:solidFill><a:schemeClr val="accent1"/></a:solidFill></a:ln>
        <a:ln w="28575"><a:solidFill><a:schemeClr val="accent1"/></a:solidFill></a:ln>
      </a:lnStyleLst>
      
      <a:effectStyleLst>
        <a:effectStyle><a:effectLst/></a:effectStyle>
        <a:effectStyle><a:effectLst/></a:effectStyle>
        <a:effectStyle><a:effectLst/></a:effectStyle>
      </a:effectStyleLst>
    </a:fmtScheme>
  </a:themeElements>
</a:theme>
```

### **ppt/slideMasters/slideMaster1.xml** (with text style carriers)
```xml
<p:sldMaster xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main"
             xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"
             xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main">
  <p:cSld>
    <!-- CARRIER: Background reference -->
    <p:bg><p:bgRef idx="1001"><a:schemeClr val="{{background.scheme.color}}"/></p:bgRef></p:bg>
    
    <!-- CARRIERS: Designer guides (designers will love you!) -->
    <p:guides>
      <p:guide orient="{{guide.horizontal.1.orient}}" pos="{{guide.horizontal.1.pos_emu}}"/>
      <p:guide orient="{{guide.vertical.1.orient}}" pos="{{guide.vertical.1.pos_emu}}"/>
      <p:guide orient="{{guide.horizontal.2.orient}}" pos="{{guide.horizontal.2.pos_emu}}"/>
      <p:guide orient="{{guide.vertical.2.orient}}" pos="{{guide.vertical.2.pos_emu}}"/>
    </p:guides>
    
    <p:spTree>
      <p:nvGrpSpPr><p:cNvPr id="1" name=""/><p:cNvGrpSpPr/><p:nvPr/></p:nvGrpSpPr>
      <p:grpSpPr><a:xfrm/></p:grpSpPr>

      <!-- CARRIERS: Title placeholder -->
      <p:sp>
        <p:nvSpPr>
          <p:cNvPr id="2" name="Title Placeholder"/>
          <p:cNvSpPr/><p:nvPr><p:ph type="title"/></p:nvPr>
        </p:nvSpPr>
        <p:spPr>
          <!-- CARRIER: Explicit shape fill -->
          <a:solidFill><a:srgbClr val="{{shape.default.fill.color}}"/></a:solidFill>
          <a:ln w="{{shape.default.line.width_emu}}">
            <a:solidFill><a:srgbClr val="{{shape.default.line.color}}"/></a:solidFill>
          </a:ln>
        </p:spPr>
        <p:txBody>
          <!-- CARRIER: Text auto-fit mode -->
          <a:bodyPr autofit="{{text.autofit.mode}}" fontScale="{{text.autofit.fontscale}}" lnSpcReduction="{{text.autofit.linespace}}"/>
          <a:lstStyle/>
          <a:p><a:endParaRPr lang="{{master.title.lang}}"/></a:p>
        </p:txBody>
      </p:sp>

      <!-- CARRIERS: Body placeholder -->
      <p:sp>
        <p:nvSpPr>
          <p:cNvPr id="3" name="Body Placeholder"/>
          <p:cNvSpPr/><p:nvPr><p:ph type="body" idx="1"/></p:nvPr>
        </p:nvSpPr>
        <p:spPr/>
        <p:txBody>
          <!-- CARRIER: Text auto-fit -->
          <a:bodyPr autofit="{{text.autofit.mode}}"/>
          <a:lstStyle/>
          <a:p><a:endParaRPr lang="{{master.level1.lang}}"/></a:p>
        </p:txBody>
      </p:sp>
    </p:spTree>
  </p:cSld>

  <!-- CRITICAL CARRIERS: Master text styles (levels 1-3 fully specified) -->
  <p:txStyles>
    <p:titleStyle>
      <a:lvl1pPr algn="{{master.title.align}}">
        <a:defRPr sz="{{master.title.size_emu}}" lang="{{master.title.lang}}"/>
      </a:lvl1pPr>
    </p:titleStyle>

    <p:bodyStyle>
      <!-- CARRIER: Level 1 fully specified -->
      <a:lvl1pPr marL="{{master.level1.margin_emu}}" indent="{{master.level1.indent_emu}}">
        <a:buChar char="{{master.level1.bullet.char}}"/>
        <a:buFont typeface="{{master.level1.bullet.font}}"/>
        <a:defRPr sz="{{master.level1.size_emu}}" lang="{{master.level1.lang}}">
          <a:solidFill><a:schemeClr val="{{master.level1.color}}"/></a:solidFill>
        </a:defRPr>
      </a:lvl1pPr>
      
      <!-- CARRIER: Level 2 fully specified -->
      <a:lvl2pPr marL="{{master.level2.margin_emu}}" indent="{{master.level2.indent_emu}}">
        <a:buChar char="{{master.level2.bullet.char}}"/>
        <a:buFont typeface="{{master.level1.bullet.font}}"/>
        <a:defRPr sz="{{master.level2.size_emu}}" lang="{{master.level1.lang}}">
          <a:solidFill><a:schemeClr val="{{master.level1.color}}"/></a:solidFill>
        </a:defRPr>
      </a:lvl2pPr>
      
      <!-- CARRIER: Level 3 fully specified -->
      <a:lvl3pPr marL="{{master.level3.margin_emu}}" indent="{{master.level3.indent_emu}}">
        <a:buChar char="{{master.level3.bullet.char}}"/>
        <a:buFont typeface="{{master.level1.bullet.font}}"/>
        <a:defRPr sz="{{master.level3.size_emu}}" lang="{{master.level1.lang}}">
          <a:solidFill><a:schemeClr val="{{master.level1.color}}"/></a:solidFill>
        </a:defRPr>
      </a:lvl3pPr>
    </p:bodyStyle>

    <p:otherStyle>
      <a:defPPr><a:defRPr sz="{{master.other.size_emu}}"/></a:defPPr>
    </p:otherStyle>
  </p:txStyles>

  <!-- CARRIERS: Header/footer visibility -->
  <p:hdrFooter sldNum="{{header.slidenum.visible}}" dt="{{header.date.visible}}" hdr="0" ftr="{{header.footer.visible}}"/>

  <!-- CARRIERS: Color map override -->
  <p:clrMapOvr>
    <a:overrideClrMapping 
      bg1="{{colormap.bg1}}" tx1="{{colormap.tx1}}"
      bg2="{{colormap.bg2}}" tx2="{{colormap.tx2}}"
      accent1="{{colormap.accent1}}" accent2="{{colormap.accent2}}"
      accent3="{{colormap.accent3}}" accent4="{{colormap.accent4}}"
      accent5="{{colormap.accent5}}" accent6="{{colormap.accent6}}"
      hlink="{{colormap.hlink}}" folHlink="{{colormap.folHlink}}"/>
  </p:clrMapOvr>

  <p:sldLayoutIdLst>
    <p:sldLayoutId id="1" r:id="rIdLayout1"/>
  </p:sldLayoutIdLst>
</p:sldMaster>
```

### **ppt/slides/slide1.xml** (with transition carriers)
```xml
<p:sld xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main"
       xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"
       xmlns:p="http://schemas.openxmlformats.org/presentationml/2006/main">
  <p:cSld>
    <p:spTree>
      <p:nvGrpSpPr><p:cNvPr id="1" name=""/><p:cNvGrpSpPr/><p:nvPr/></p:nvGrpSpPr>
      <p:grpSpPr><a:xfrm/></p:grpSpPr>
      
      <!-- Sample shape with CARRIER defaults -->
      <p:sp>
        <p:nvSpPr>
          <p:cNvPr id="2" name="Sample Shape"/>
          <p:cNvSpPr/><p:nvPr/>
        </p:nvSpPr>
        <p:spPr>
          <a:prstGeom prst="rect"><a:avLst/></a:prstGeom>
          <!-- CARRIERS: Explicit fill and line -->
          <a:solidFill><a:srgbClr val="{{shape.default.fill.color}}"/></a:solidFill>
          <a:ln w="{{shape.default.line.width_emu}}">
            <a:solidFill><a:srgbClr val="{{shape.default.line.color}}"/></a:solidFill>
          </a:ln>
        </p:spPr>
        <p:txBody>
          <a:bodyPr autofit="{{text.autofit.mode}}"/>
          <a:lstStyle/>
          <a:p><a:r><a:t>Sample Text</a:t></a:r></a:p>
        </p:txBody>
      </p:sp>
    </p:spTree>
  </p:cSld>

  <!-- CRITICAL CARRIERS: Transition settings -->
  <p:transition 
    spd="{{transition.speed}}" 
    advClick="{{transition.advance.click}}"
    advTm="{{transition.advance.time}}">
    <p:fade/>
  </p:transition>
</p:sld>
```

### **ppt/tableStyles.xml** (with table carriers)
```xml
<a:tblStyleLst xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" 
               def="{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}">
  
  <a:tblStyle styleId="{StyleStack-Table-ID}" styleName="StyleStack Table">
    <!-- CARRIERS: Table properties with explicit margins -->
    <a:wholeTbl>
      <a:tcTxStyle>
        <a:fontRef idx="minor"><a:schemeClr val="{{master.level1.color}}"/></a:fontRef>
        <a:schemeClr val="{{master.level1.color}}"/>
      </a:tcTxStyle>
      <a:tcStyle>
        <a:tcBdr>
          <a:left><a:ln w="{{table.border.width_emu}}"><a:solidFill><a:srgbClr val="{{table.border.color}}"/></a:solidFill></a:ln></a:left>
          <a:right><a:ln w="{{table.border.width_emu}}"><a:solidFill><a:srgbClr val="{{table.border.color}}"/></a:solidFill></a:ln></a:right>
          <a:top><a:ln w="{{table.border.width_emu}}"><a:solidFill><a:srgbClr val="{{table.border.color}}"/></a:solidFill></a:ln></a:top>
          <a:bottom><a:ln w="{{table.border.width_emu}}"><a:solidFill><a:srgbClr val="{{table.border.color}}"/></a:solidFill></a:ln></a:bottom>
        </a:tcBdr>
        <!-- CARRIERS: Cell margins -->
        <a:cell3D/>
        <a:fill><a:solidFill><a:schemeClr val="lt1"/></a:solidFill></a:fill>
      </a:tcStyle>
    </a:wholeTbl>
    
    <!-- CARRIERS: First row (header) -->
    <a:firstRow>
      <a:tcTxStyle b="on">
        <a:fontRef idx="minor"><a:schemeClr val="{{master.level1.color}}"/></a:fontRef>
        <a:schemeClr val="{{master.level1.color}}"/>
      </a:tcTxStyle>
      <a:tcStyle>
        <a:fill><a:solidFill><a:srgbClr val="{{table.header.fill}}"/></a:solidFill></a:fill>
      </a:tcStyle>
    </a:firstRow>
    
    <!-- CARRIERS: Banded rows -->
    <a:band1H>
      <a:tcStyle>
        <a:fill><a:solidFill><a:srgbClr val="{{table.row.alternate.fill}}"/></a:solidFill></a:fill>
      </a:tcStyle>
    </a:band1H>
  </a:tblStyle>
</a:tblStyleLst>
```

---

## **Super Themes Integration**

### Multiple Theme Variants in Base Template

Super Themes = multiple complete theme definitions in a single template:

```xml
<!-- Primary theme: theme1.xml -->
<a:theme name="StyleStack Primary">
  <!-- Full theme with {{theme.primary.*}} carriers -->
</a:theme>

<!-- Secondary theme: theme2.xml -->
<a:theme name="StyleStack Secondary">
  <!-- Variant theme with {{theme.secondary.*}} carriers -->
</a:theme>

<!-- Dark theme: theme3.xml -->
<a:theme name="StyleStack Dark">
  <!-- Dark variant with {{theme.dark.*}} carriers -->
</a:theme>
```

### Theme Selection at Build Time

```yaml
# Design tokens can specify theme variant
theme.variant: "primary"           # primary|secondary|dark
theme.primary.color.accent1: "#0066FF"
theme.secondary.color.accent1: "#00C853"  
theme.dark.color.accent1: "#66B3FF"
```

---

## **Variable Resolution Process**

1. **Base Templates** contain `{{carrier.property.value_emu}}` placeholders
2. **Design Token Hierarchy** resolves variables:
   - Design System tokens (global)
   - Corporate tokens (brand overrides)
   - Channel tokens (use case specialization)  
   - Template tokens (final overrides)
3. **Build Process** substitutes resolved values into template
4. **Output** is fully resolved .potx/.dotx/.xltx with no variables

**Result**: Zero runtime processing, immediate template availability, perfect brand compliance.

---

## **Key Benefits**

✅ **Zero Runtime Latency** - All variables resolved at build time  
✅ **Perfect Brand Compliance** - Hierarchical token resolution  
✅ **Designer Friendly** - Guides, proper spacing, professional typography  
✅ **Predictable Behavior** - Explicit choices for all formatting  
✅ **Cross-Platform** - Same carrier system for Office/LibreOffice/Google  
✅ **Enterprise Ready** - Template validation, error reporting, rollback  

This is how StyleStack becomes the **only solution** that delivers truly professional, brand-compliant Office templates with zero maintenance.