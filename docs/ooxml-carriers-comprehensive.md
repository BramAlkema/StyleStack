# OOXML Carriers & Parts: Comprehensive Documentation

> **Master reference for StyleStack's OOXML carrier variable system**

This document consolidates all essential knowledge about OOXML carriers, parts, and the variable substitution system that powers StyleStack's design-as-code approach.

---

## Table of Contents

1. [Overview & Architecture](#overview--architecture)
2. [Critical Carriers (The Essential 8)](#critical-carriers-the-essential-8)
3. [Overlooked Carriers That Matter](#overlooked-carriers-that-matter)
4. [Base Template Structure](#base-template-structure)
5. [OOXML Primitives by Application](#ooxml-primitives-by-application)
6. [Variable Resolution Process](#variable-resolution-process)
7. [Super Themes Integration](#super-themes-integration)
8. [Implementation Guidelines](#implementation-guidelines)

---

## Overview & Architecture

### Key Insight
**All OOXML structures must be pre-embedded in base templates** with `{{carrier.property.value_emu}}` placeholders, **not** generated by a patcher.

### StyleStack Carrier Philosophy
- **Zero Runtime Processing** - All variables resolved at build time
- **Explicit Over Implicit** - Never rely on Office defaults
- **Professional by Default** - Every template looks designed
- **Cross-Platform Consistency** - Same carriers work for Office, LibreOffice, Google

### The Problem We Solve
Office applications fill missing OOXML parts with ugly system defaults:
- Times New Roman instead of brand fonts
- Office Blue instead of brand colors
- Basic bullets instead of professional typography
- Generic spacing instead of design system rules

---

## Critical Carriers (The Essential 8)

> **TL;DR**: If you set nothing else, set these 8 for professional templates

### 1. **THEME** (Critical Foundation)

**Color Scheme with Hyperlinks**
```xml
<a:clrScheme name="StyleStack Colors">
  <a:dk1><a:srgbClr val="{{theme.color.dk1}}"/></a:dk1>
  <a:lt1><a:srgbClr val="{{theme.color.lt1}}"/></a:lt1>
  <a:dk2><a:srgbClr val="{{theme.color.dk2}}"/></a:dk2>
  <a:lt2><a:srgbClr val="{{theme.color.lt2}}"/></a:lt2>
  <a:accent1><a:srgbClr val="{{theme.color.accent1}}"/></a:accent1>
  <a:accent2><a:srgbClr val="{{theme.color.accent2}}"/></a:accent2>
  <a:accent3><a:srgbClr val="{{theme.color.accent3}}"/></a:accent3>
  <a:accent4><a:srgbClr val="{{theme.color.accent4}}"/></a:accent4>
  <a:accent5><a:srgbClr val="{{theme.color.accent5}}"/></a:accent5>
  <a:accent6><a:srgbClr val="{{theme.color.accent6}}"/></a:accent6>
  <!-- CRITICAL: Hyperlink colors -->
  <a:hlink><a:srgbClr val="{{theme.color.hlink}}"/></a:hlink>
  <a:folHlink><a:srgbClr val="{{theme.color.folHlink}}"/></a:folHlink>
</a:clrScheme>
```

**Font Scheme (Proper Major/Minor/EA/CS)**
```xml
<a:fontScheme name="StyleStack Fonts">
  <a:majorFont>
    <a:latin typeface="{{theme.font.major.latin}}"/>
    <a:ea typeface="{{theme.font.major.ea}}"/>
    <a:cs typeface="{{theme.font.major.cs}}"/>
  </a:majorFont>
  <a:minorFont>
    <a:latin typeface="{{theme.font.minor.latin}}"/>
    <a:ea typeface="{{theme.font.minor.ea}}"/>
    <a:cs typeface="{{theme.font.minor.cs}}"/>
  </a:minorFont>
</a:fontScheme>
```

**Background Fill Style List (CRITICAL)**
```xml
<a:fmtScheme name="StyleStack Effects">
  <a:fillStyleLst>
    <a:solidFill><a:schemeClr val="lt1"/></a:solidFill>
    <a:gradFill><!-- moderate gradient --></a:gradFill>
    <a:gradFill><!-- intense gradient --></a:gradFill>
  </a:fillStyleLst>
  
  <!-- CRITICAL: Background fills (referenced by bgRef idx) -->
  <a:bgFillStyleLst>
    <a:solidFill><a:schemeClr val="lt1"/></a:solidFill>
    <a:gradFill><!-- subtle bg gradient --></a:gradFill>
    <a:solidFill><a:schemeClr val="dk1"><a:tint val="95000"/></a:schemeClr></a:solidFill>
  </a:bgFillStyleLst>
</a:fmtScheme>
```

**Essential Variables:**
```yaml
theme.color.hlink: "#1155CC"           # CRITICAL: hyperlink color
theme.color.folHlink: "#551A8B"        # CRITICAL: followed hyperlink
theme.font.major.latin: "Inter"        # Major font (headings)
theme.font.minor.latin: "Inter"        # Minor font (body text)
theme.font.major.ea: "Noto Sans CJK SC"    # East Asian major
theme.font.minor.ea: "Noto Sans CJK SC"    # East Asian minor  
theme.font.major.cs: "Arial"           # Complex Script major
theme.font.minor.cs: "Arial"           # Complex Script minor
```

### 2. **POWERPOINT MASTER TEXT STYLES** (Critical)

**Levels 1-3 Fully Specified**
```xml
<p:txStyles>
  <p:titleStyle>
    <a:lvl1pPr algn="{{master.title.align}}">
      <a:defRPr sz="{{master.title.size_emu}}" lang="{{master.title.lang}}"/>
    </a:lvl1pPr>
  </p:titleStyle>
  
  <p:bodyStyle>
    <!-- CRITICAL: Level 1 fully specified -->
    <a:lvl1pPr marL="{{master.level1.margin_emu}}" indent="{{master.level1.indent_emu}}">
      <a:buChar char="{{master.level1.bullet.char}}"/>
      <a:buFont typeface="{{master.level1.bullet.font}}"/>
      <a:defRPr sz="{{master.level1.size_emu}}" lang="{{master.level1.lang}}">
        <a:solidFill><a:schemeClr val="{{master.level1.color}}"/></a:solidFill>
      </a:defRPr>
    </a:lvl1pPr>
    
    <!-- CRITICAL: Level 2 fully specified -->
    <a:lvl2pPr marL="{{master.level2.margin_emu}}" indent="{{master.level2.indent_emu}}">
      <a:buChar char="{{master.level2.bullet.char}}"/>
      <a:defRPr sz="{{master.level2.size_emu}}" lang="{{master.level1.lang}}"/>
    </a:lvl2pPr>
    
    <!-- CRITICAL: Level 3 fully specified -->
    <a:lvl3pPr marL="{{master.level3.margin_emu}}" indent="{{master.level3.indent_emu}}">
      <a:buChar char="{{master.level3.bullet.char}}"/>
      <a:defRPr sz="{{master.level3.size_emu}}" lang="{{master.level1.lang}}"/>
    </a:lvl3pPr>
  </p:bodyStyle>
</p:txStyles>
```

**Essential Variables:**
```yaml
# Title styling
master.title.size_emu: "32400"        # 18pt * 1800 EMU/pt
master.title.align: "ctr"             # l|ctr|r
master.title.lang: "en-US"

# Level 1 (CRITICAL)
master.level1.margin_emu: "457200"    # 0.5 inch left margin
master.level1.indent_emu: "-228600"   # -0.25 inch hanging indent  
master.level1.bullet.char: "•"
master.level1.bullet.font: "Symbol"
master.level1.size_emu: "18000"       # 10pt * 1800
master.level1.color: "tx1"            # theme text color
master.level1.lang: "en-US"

# Level 2 (CRITICAL)
master.level2.margin_emu: "685800"    # 0.75 inch
master.level2.indent_emu: "-228600"
master.level2.bullet.char: "◦"
master.level2.size_emu: "16200"       # 9pt * 1800

# Level 3 (CRITICAL)
master.level3.margin_emu: "914400"    # 1 inch
master.level3.indent_emu: "-228600" 
master.level3.bullet.char: "▪"
master.level3.size_emu: "14400"       # 8pt * 1800
```

### 3. **TEXT AUTO-FIT** (Critical Choice)

**Every Placeholder Must Choose Explicitly**
```xml
<p:txBody>
  <!-- CRITICAL: Choose auto-fit mode explicitly -->
  <a:bodyPr 
    wrap="none" 
    rtlCol="0"
    anchor="t"
    autofit="{{text.autofit.mode}}"
    fontScale="{{text.autofit.fontscale}}"
    lnSpcReduction="{{text.autofit.linespace}}">
  </a:bodyPr>
</p:txBody>
```

**Essential Variables:**
```yaml
text.autofit.mode: "noAutofit"        # CRITICAL: noAutofit|normAutofit|spAutofit
text.autofit.fontscale: "100000"      # 100% (only if normAutofit)
text.autofit.linespace: "95000"       # 95% line spacing reduction
```

### 4. **SHAPE DEFAULTS** (Critical Explicit Styling)

**Every Shape Needs Explicit Fill and Line**
```xml
<p:sp>
  <p:spPr>
    <!-- CRITICAL: Explicit fill, never rely on defaults -->
    <a:solidFill>
      <a:srgbClr val="{{shape.default.fill.color}}"/>
    </a:solidFill>
    
    <!-- CRITICAL: Explicit line width and color -->
    <a:ln w="{{shape.default.line.width_emu}}">
      <a:solidFill>
        <a:srgbClr val="{{shape.default.line.color}}"/>
      </a:solidFill>
    </a:ln>
  </p:spPr>
</p:sp>
```

**Essential Variables:**
```yaml
shape.default.fill.color: "#F0F0F0"   # Light gray fill
shape.default.line.width_emu: "12700"  # 1pt in EMU
shape.default.line.color: "#CCCCCC"   # Light gray border
```

### 5. **TABLE FLAGS + MARGINS** (Critical Configuration)

**Don't Rely on GUID Alone**
```xml
<a:tbl>
  <!-- CRITICAL: Explicit table properties -->
  <a:tblPr 
    firstRow="{{table.flags.firstRow}}" 
    lastRow="{{table.flags.lastRow}}"
    firstCol="{{table.flags.firstColumn}}" 
    lastCol="{{table.flags.lastColumn}}"
    bandRow="{{table.flags.bandedRows}}" 
    bandCol="{{table.flags.bandedColumns}}">
    
    <!-- CRITICAL: Explicit cell margins -->
    <a:tblCellMar>
      <a:top w="{{table.cell.margin.top_emu}}" type="dxa"/>
      <a:left w="{{table.cell.margin.left_emu}}" type="dxa"/>
      <a:bottom w="{{table.cell.margin.bottom_emu}}" type="dxa"/>
      <a:right w="{{table.cell.margin.right_emu}}" type="dxa"/>
    </a:tblCellMar>
  </a:tblPr>
</a:tbl>
```

**Essential Variables:**
```yaml
table.flags.firstRow: "1"             # CRITICAL: header row formatting
table.flags.lastRow: "0"              # Total row formatting
table.flags.firstColumn: "1"          # First column formatting  
table.flags.lastColumn: "0"           # Last column formatting
table.flags.bandedRows: "1"           # Alternating row colors
table.flags.bandedColumns: "0"        # Alternating column colors

table.cell.margin.top_emu: "45720"    # CRITICAL: explicit margins
table.cell.margin.bottom_emu: "45720" # (0.032 inch = 45720 EMU)
table.cell.margin.left_emu: "91440"   # (0.064 inch = 91440 EMU)  
table.cell.margin.right_emu: "91440"
```

### 6. **TRANSITIONS** (Critical Predictability)

**Set Explicitly So Playback is Predictable**
```xml
<p:slide>
  <!-- CRITICAL: Explicit transition settings -->
  <p:transition 
    spd="{{transition.speed}}" 
    advClick="{{transition.advance.click}}"
    advTm="{{transition.advance.time}}">
    
    <!-- Optional: transition type -->
    <p:fade/>  <!-- or p:cut, p:push, p:wipe, etc. -->
  </p:transition>
</p:slide>
```

**Essential Variables:**
```yaml
transition.speed: "fast"              # slow|med|fast
transition.advance.click: "1"         # 0=auto after time, 1=on click
transition.advance.time: "0"          # milliseconds (if auto)
transition.type: "fade"               # cut|fade|push|wipe|split|reveal
```

### 7. **COLOR MAP OVERRIDES** (Layout/Slide Level)

**When Layout/Slide Swaps Theme Slots**
```xml
<p:clrMapOvr>
  <a:overrideClrMapping 
    bg1="{{colormap.bg1}}" 
    tx1="{{colormap.tx1}}"
    bg2="{{colormap.bg2}}" 
    tx2="{{colormap.tx2}}"
    accent1="{{colormap.accent1}}" 
    accent2="{{colormap.accent2}}"
    accent3="{{colormap.accent3}}" 
    accent4="{{colormap.accent4}}"
    accent5="{{colormap.accent5}}" 
    accent6="{{colormap.accent6}}"
    hlink="{{colormap.hlink}}" 
    folHlink="{{colormap.folHlink}}"/>
</p:clrMapOvr>
```

**Essential Variables:**
```yaml
colormap.bg1: "lt1"                   # background 1 → light 1
colormap.tx1: "dk1"                   # text 1 → dark 1  
colormap.bg2: "lt2"                   # background 2 → light 2
colormap.tx2: "dk2"                   # text 2 → dark 2
colormap.accent1: "accent1"           # can remap any accent
colormap.accent2: "accent2"
# ... etc for all accent colors
colormap.hlink: "hlink"               # hyperlink mapping
colormap.folHlink: "folHlink"         # followed hyperlink mapping
```

### 8. **GUIDES ON MASTER** (Designer Love)

**Invisible Helpers for Perfect Alignment**
```xml
<p:sldMaster>
  <p:cSld>
    <!-- CRITICAL: Designer guides -->
    <p:guides>
      <p:guide orient="{{guide.horizontal.1.orient}}" pos="{{guide.horizontal.1.pos_emu}}"/>
      <p:guide orient="{{guide.vertical.1.orient}}" pos="{{guide.vertical.1.pos_emu}}"/>
      <p:guide orient="{{guide.horizontal.2.orient}}" pos="{{guide.horizontal.2.pos_emu}}"/>
      <p:guide orient="{{guide.vertical.2.orient}}" pos="{{guide.vertical.2.pos_emu}}"/>
    </p:guides>
  </p:cSld>
</p:sldMaster>
```

**Essential Variables:**
```yaml
# Guides (designers will love you, everyone else won't notice)
guide.horizontal.1.pos_emu: "914400"     # 1 inch from top
guide.horizontal.2.pos_emu: "4572000"    # 5 inches (center for 10" slide)
guide.vertical.1.pos_emu: "914400"       # 1 inch from left  
guide.vertical.2.pos_emu: "4572000"      # 5 inches (center)
guide.horizontal.1.orient: "1"           # 1=horizontal, 0=vertical
guide.vertical.1.orient: "0"
```

---

## Overlooked Carriers That Matter

> **TL;DR**: These OOXML parts get filled with system defaults if not explicitly set

### Visual Default Carriers (✅ Critical)

#### **styles.xml** (Word/Excel) 
**What it carries:** Fonts, colors, sizes, spacing, table styles  
**Ugly defaults if missed:**
- Times New Roman 12pt instead of brand fonts
- Black text on white instead of theme colors  
- Single line spacing instead of professional 1.15x
- Basic table borders instead of branded styles

**Base template carriers needed:**
```xml
<w:docDefaults>
  <w:rPrDefault>
    <w:rPr>
      <w:rFonts w:ascii="{{brand.font.body}}" w:hAnsi="{{brand.font.body}}"/>
      <w:sz w:val="{{text.size.body_halfpts}}"/>
      <w:color w:val="{{theme.color.text}}"/>
    </w:rPr>
  </w:rPrDefault>
  <w:pPrDefault>
    <w:pPr>
      <w:spacing w:line="{{text.line.spacing_240ths}}" w:lineRule="auto"/>
    </w:pPr>
  </w:pPrDefault>
</w:docDefaults>
```

#### **slideMasters/*.xml** (PowerPoint)
**What it carries:** Background, placeholder txStyles, bullets  
**Ugly defaults if missed:**
- White slide backgrounds
- Bullet • instead of brand bullets
- 18pt/16pt/14pt instead of brand hierarchy

#### **numbering.xml** (Word)
**What it carries:** Bullet/number glyph, indents  
**Ugly defaults if missed:**
- Basic • bullets
- Generic indent spacing
- Wrong numbering formats

#### **xl/styles.xml** (Excel)
**What it carries:** Fonts, fills, borders, table/cell style refs  
**Ugly defaults if missed:**
- Calibri 11pt everywhere
- No cell borders
- Basic table formatting

### Settings/Behavior Carriers (⚙️ Functional)

#### **settings.xml** (Word)
**What it carries:** Footnote styles, zoom, compat, language  
**Weird behavior if missed:**
- Wrong default language = spell check issues
- Wrong zoom = user UX issues  
- Compatibility mode = formatting breaks

```xml
<w:settings>
  <w:defaultTabStop w:val="{{word.tab.default}}"/>
  <w:characterSpacingControl w:val="{{word.spacing.control}}"/>
  <w:compat>
    <w:compatSetting w:name="compatibilityMode" w:val="{{word.compat.mode}}"/>
  </w:compat>
  <w:themeFontLang w:val="{{word.lang.default}}"/>
  <w:zoom w:percent="{{word.zoom.default}}"/>
</w:settings>
```

---

## Base Template Structure

### PowerPoint Base Template (.potx) Architecture

```
templates/microsoft/presentation.potx (ZIP archive)
├── [Content_Types].xml
├── _rels/
│   └── .rels
└── ppt/
    ├── presentation.xml          # Slide dimensions, default text
    ├── _rels/presentation.xml.rels
    ├── theme/
    │   └── theme1.xml           # Color/font/effect schemes
    ├── slideMasters/
    │   └── slideMaster1.xml     # Text styles, guides, backgrounds
    ├── slideLayouts/
    │   └── slideLayout1.xml     # Color map overrides
    ├── slides/
    │   └── slide1.xml           # Transition settings
    └── tableStyles.xml          # Table formatting
```

### Essential Embedded Structures

**All base templates must include:**

1. **Theme with complete color/font schemes** (`theme1.xml`)
2. **Master text styles with levels 1-3** (`slideMaster1.xml`)
3. **Explicit shape fills and lines** (all shape elements)
4. **Text autofit choices** (all bodyPr elements)
5. **Table properties and margins** (`tableStyles.xml`)
6. **Transition settings** (all slide elements)
7. **Color map overrides** (layout/slide level)
8. **Designer guides** (master level)

---

## OOXML Primitives by Application

### PowerPoint Core Mappings

| Design Token | OOXML Primitive | XPath Target | Example |
|--------------|-----------------|--------------|---------|
| `color.primary` | `<a:srgbClr val=""/>` | `//a:srgbClr[@val]/@val` | `0EA5E9` |
| `color.text.primary` | `<a:schemeClr val="dk1"/>` | `//a:schemeClr[@val='dk1']/@val` | `dk1` |
| `typography.font.primary` | `<a:latin typeface=""/>` | `//a:latin/@typeface` | `Inter` |
| `typography.size.body` | `<a:defRPr sz=""/>` | `//a:defRPr/@sz` | `2400` (24pt) |
| `layout.slide.width` | `<p:sldSz cx=""/>` | `//p:sldSz/@cx` | `7772400` |

### Word Core Mappings

| Design Token | OOXML Primitive | XPath Target | Example |
|--------------|-----------------|--------------|---------|
| `typography.font.body` | `<w:rFonts w:ascii=""/>` | `//w:rFonts/@w:ascii` | `Inter` |
| `typography.size.body` | `<w:sz w:val=""/>` | `//w:sz/@w:val` | `24` (12pt) |
| `color.text` | `<w:color w:val=""/>` | `//w:color/@w:val` | `000000` |
| `spacing.line` | `<w:spacing w:line=""/>` | `//w:spacing/@w:line` | `276` (1.15x) |

### Excel Core Mappings  

| Design Token | OOXML Primitive | XPath Target | Example |
|--------------|-----------------|--------------|---------|
| `typography.font.default` | `<name val=""/>` | `//fonts/font/name/@val` | `Inter` |
| `typography.size.default` | `<sz val=""/>` | `//fonts/font/sz/@val` | `11` |
| `color.text` | `<color rgb=""/>` | `//fonts/font/color/@rgb` | `FF000000` |

---

## Variable Resolution Process

### 1. Hierarchical Design Tokens

```yaml
# Design System (global foundation)
typography.font.primary: "Inter"
color.primary: "#0066FF"

# Corporate (brand overrides)  
org.acme.color.primary: "#FF0000"
org.acme.typography.font.primary: "Roboto"

# Channel (use-case specialization)
channel.finance.color.primary: "#008000"

# Template (final overrides)
template.presentation.title.size: "32400"
```

### 2. Resolution Order
1. **Template tokens** (highest priority)
2. **Channel tokens** 
3. **Corporate tokens**
4. **Design System tokens** (lowest priority)

### 3. Build Process
1. **Load** base template (.potx/.dotx/.xltx) 
2. **Parse** hierarchical design tokens
3. **Resolve** variables with precedence rules
4. **Substitute** `{{carrier.property.value}}` placeholders
5. **Validate** output template integrity
6. **Output** fully resolved template

### 4. Result
✅ **Zero Runtime Processing** - All variables resolved at build time  
✅ **Perfect Brand Compliance** - Hierarchical token resolution  
✅ **Immediate Availability** - Templates ready to use instantly

---

## Super Themes Integration

### Multiple Theme Variants in Base Template

Super Themes = multiple complete theme definitions in a single template:

```xml
<!-- Primary theme: theme1.xml -->
<a:theme name="StyleStack Primary">
  <a:clrScheme name="Primary">
    <a:accent1><a:srgbClr val="{{theme.primary.color.accent1}}"/></a:accent1>
  </a:clrScheme>
</a:theme>

<!-- Secondary theme: theme2.xml -->
<a:theme name="StyleStack Secondary">
  <a:clrScheme name="Secondary">
    <a:accent1><a:srgbClr val="{{theme.secondary.color.accent1}}"/></a:accent1>
  </a:clrScheme>
</a:theme>

<!-- Dark theme: theme3.xml -->
<a:theme name="StyleStack Dark">
  <a:clrScheme name="Dark">
    <a:accent1><a:srgbClr val="{{theme.dark.color.accent1}}"/></a:accent1>
  </a:clrScheme>
</a:theme>
```

### Theme Selection at Build Time

```yaml
# Design tokens can specify theme variant
theme.variant: "primary"           # primary|secondary|dark
theme.primary.color.accent1: "#0066FF"
theme.secondary.color.accent1: "#00C853"  
theme.dark.color.accent1: "#66B3FF"
```

---

## Implementation Guidelines

### Do's ✅

1. **Always pre-embed structures** in base templates with carrier variables
2. **Set explicit values** for all formatting - never rely on defaults
3. **Specify all 3 bullet levels** in PowerPoint master text styles  
4. **Include hyperlink colors** in theme color schemes
5. **Set explicit cell margins** in table properties
6. **Choose autofit mode explicitly** in all text placeholders
7. **Add designer guides** to slide masters
8. **Test cross-platform compatibility** with the same carrier variables

### Don'ts ❌

1. **Don't generate OOXML structures** at runtime - embed them in base templates
2. **Don't rely on Office defaults** - they're ugly and unpredictable  
3. **Don't use only GUID references** for tables - set explicit properties
4. **Don't skip hyperlink colors** - they'll default to Office Blue
5. **Don't leave autofit unspecified** - text behavior will be unpredictable
6. **Don't forget East Asian fonts** - international users will see system defaults
7. **Don't skip validation** - malformed OOXML breaks templates entirely

### Best Practices

1. **Start with the Critical 8** - implement these categories first
2. **Validate with real content** - test templates with actual data
3. **Check cross-platform rendering** - same templates should work everywhere  
4. **Monitor for ugly defaults** - scan output for system fonts/colors
5. **Version control base templates** - they're as important as code
6. **Document carrier mappings** - maintain clear variable→OOXML relationships
7. **Test with international content** - verify non-Latin scripts work correctly

---

## Summary

This comprehensive guide covers everything needed to implement StyleStack's OOXML carrier system:

- **8 Critical carrier categories** that transform templates from amateur to professional
- **Overlooked parts** that Office fills with ugly defaults if not set explicitly  
- **Complete base template structure** showing where carriers get embedded
- **Variable resolution process** that enables design-as-code workflows
- **Implementation guidelines** for building robust, cross-platform templates

**Result**: Professional, brand-compliant Office templates that work consistently across all platforms with zero maintenance.