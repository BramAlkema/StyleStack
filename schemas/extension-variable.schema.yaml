# StyleStack OOXML Extension Variable Schema (YAML version)
# Human-friendly schema for defining variables in OOXML templates

$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://stylestack.dev/schemas/extension-variable.schema.yaml"
title: "StyleStack OOXML Extension Variable Schema"
description: "Schema for defining variables that can be embedded in OOXML templates using extension lists"
version: "1.0.0"

# Variable definition structure
type: object
properties:
  
  # Core variable identification
  id:
    type: string
    pattern: "^[a-zA-Z][a-zA-Z0-9._]*$"
    minLength: 1
    maxLength: 64
    description: "Unique identifier (letters, numbers, dots, underscores only)"
    examples:
      - "accent_primary"
      - "heading_font"
      - "slide_width"
      - "margin_top"
  
  # Variable classification  
  type:
    type: string
    enum:
      - color      # Color values (hex, theme references)
      - font       # Font family names
      - dimension  # Sizes, widths, heights 
      - position   # X/Y coordinates
      - text       # Text content
      - boolean    # True/false values
      - number     # Numeric values
    description: "The type of value this variable represents"
  
  scope:
    type: string
    enum:
      - theme      # Theme-level (colors, fonts)
      - slide      # Slide-level (PowerPoint)
      - shape      # Individual shapes/objects
      - paragraph  # Paragraph formatting
      - run        # Text run formatting
      - document   # Document-level (Word)
      - workbook   # Workbook-level (Excel)
      - worksheet  # Worksheet-level (Excel)
    description: "The scope within OOXML where this variable applies"
  
  # OOXML targeting
  xpath:
    type: string
    minLength: 1
    description: "XPath expression to locate target element/attribute"
    examples:
      - "//a:clrScheme/a:accent1/a:srgbClr/@val"        # Theme color
      - "//a:fontScheme/a:majorFont/a:latin/@typeface"  # Theme font
      - "//p:sldSz/@cx"                                 # Slide width
      - "//w:rPr/w:sz/@w:val"                          # Word font size
      - "//a:off/@x"                                   # Shape X position
  
  # OOXML integration details
  ooxml:
    type: object
    properties:
      namespace:
        type: string
        format: uri
        enum:
          - "http://schemas.openxmlformats.org/drawingml/2006/main"
          - "http://schemas.openxmlformats.org/presentationml/2006/main"
          - "http://schemas.openxmlformats.org/wordprocessingml/2006/main"
          - "http://schemas.openxmlformats.org/spreadsheetml/2006/main"
        description: "OOXML namespace URI for target element"
        
      element:
        type: string
        minLength: 1
        description: "OOXML element name (without namespace prefix)"
        examples: ["srgbClr", "latin", "sldSz", "rPr", "off"]
        
      attribute:
        type: string
        description: "OOXML attribute name (optional, for attribute targets)"
        examples: ["val", "typeface", "cx", "cy", "x", "y"]
        
      valueType:
        type: string
        enum:
          - direct      # Use value as-is
          - schemeClr   # Convert to theme color reference
          - themeFont   # Convert to theme font reference
          - emu         # Convert to EMU units
          - calculated  # Calculate from dependencies
          - percentage  # Convert to percentage
          - boolean     # Convert to OOXML boolean (0/1)
        description: "How to apply the variable value to OOXML"
        
    required: [namespace, element, valueType]
    additionalProperties: false
  
  # Default and validation
  defaultValue:
    description: "Default value when token is not provided"
    examples:
      - "0066CC"     # Hex color
      - "Segoe UI"   # Font name
      - "9144000"    # Dimension in EMU
      - true         # Boolean
      - 1.5          # Number
  
  dependencies:
    type: array
    items:
      type: string
      pattern: "^[a-zA-Z][a-zA-Z0-9._]*$"
    uniqueItems: true
    description: "Variable IDs this variable depends on (for calculated values)"
    examples:
      - ["base_font_size", "scale_factor"]
      - ["primary_color", "tint_amount"]
  
  # Documentation
  description:
    type: string
    description: "Human-readable description of what this variable controls"
    examples:
      - "Primary accent color used throughout the theme"
      - "Base font size for body text"
      - "Width of slide in EMU units"
  
  # Advanced validation rules
  validation:
    type: object
    properties:
      required:
        type: boolean
        default: false
        description: "Whether this variable must have a value"
        
      minValue:
        type: number
        description: "Minimum allowed value (for numeric types)"
        
      maxValue:
        type: number
        description: "Maximum allowed value (for numeric types)"
        
      pattern:
        type: string
        description: "Regular expression for string validation"
        examples:
          - "^[0-9A-Fa-f]{6}$"  # Hex color
          - "^\\d+(\\.\\d+)?(pt|px|em)$"  # CSS-like dimension
          
      allowedValues:
        type: array
        description: "List of allowed values"
        examples:
          - ["left", "center", "right"]
          - ["small", "medium", "large"]
    additionalProperties: false
  
  # Organizational metadata
  metadata:
    type: object
    properties:
      category:
        type: string
        enum: [layout, typography, color, branding, accessibility]
        description: "Category for organizing variables"
        
      priority:
        type: string
        enum: [critical, high, medium, low]
        default: medium
        description: "Priority level for variable application"
        
      version:
        type: string
        pattern: "^\\d+\\.\\d+\\.\\d+$"
        description: "Semantic version when variable was introduced"
        
      deprecated:
        type: boolean
        default: false
        description: "Whether this variable is deprecated"
        
      replacement:
        type: string
        pattern: "^[a-zA-Z][a-zA-Z0-9._]*$"
        description: "ID of replacement variable (if deprecated)"
    additionalProperties: false

required: [id, type, scope, xpath, ooxml]
additionalProperties: false

# Type-specific validation rules
allOf:
  # Color variables
  - if:
      properties:
        type: { const: color }
    then:
      properties:
        defaultValue:
          oneOf:
            - type: string
              pattern: "^[0-9A-Fa-f]{6}$"
              description: "6-digit hex color"
            - type: string
              enum: [accent1, accent2, accent3, accent4, accent5, accent6, bg1, bg2, tx1, tx2]
              description: "Theme color reference"
        ooxml:
          properties:
            valueType: { enum: [direct, schemeClr] }
  
  # Dimension variables            
  - if:
      properties:
        type: { const: dimension }
    then:
      properties:
        defaultValue:
          oneOf:
            - type: string
              pattern: "^\\d+(\\.\\d+)?(pt|in|mm|cm|px|emu)$"
              description: "Dimension with units"
            - type: integer
              minimum: 0
              description: "Dimension in EMU units"
        ooxml:
          properties:
            valueType: { enum: [emu, direct, calculated] }
  
  # Font variables
  - if:
      properties:
        type: { const: font }
    then:
      properties:
        defaultValue: { type: string }
        ooxml:
          properties:
            valueType: { enum: [themeFont, direct] }
  
  # Boolean variables
  - if:
      properties:
        type: { const: boolean }
    then:
      properties:
        defaultValue: { type: boolean }
        ooxml:
          properties:
            valueType: { enum: [boolean, direct] }

# Complete example configurations
examples:
  - # Theme color variable
    id: accent_primary
    type: color
    scope: theme
    xpath: "//a:clrScheme/a:accent1/a:srgbClr/@val"
    ooxml:
      namespace: "http://schemas.openxmlformats.org/drawingml/2006/main"
      element: srgbClr
      attribute: val
      valueType: schemeClr
    defaultValue: "0066CC"
    description: "Primary accent color used throughout the theme"
    validation:
      required: true
    metadata:
      category: color
      priority: high
      version: "1.0.0"
  
  - # Theme font variable
    id: heading_font
    type: font
    scope: theme
    xpath: "//a:fontScheme/a:majorFont/a:latin/@typeface"
    ooxml:
      namespace: "http://schemas.openxmlformats.org/drawingml/2006/main"
      element: latin
      attribute: typeface
      valueType: themeFont
    defaultValue: "Segoe UI"
    description: "Primary font for headings and display text"
    metadata:
      category: typography
      priority: critical
      version: "1.0.0"
  
  - # Layout dimension variable
    id: slide_width
    type: dimension
    scope: slide
    xpath: "//p:sldSz/@cx"
    ooxml:
      namespace: "http://schemas.openxmlformats.org/presentationml/2006/main"
      element: sldSz
      attribute: cx
      valueType: emu
    defaultValue: "9144000"  # 10 inches in EMU
    description: "Width of slide in EMU units"
    validation:
      minValue: 914400      # 1 inch minimum
      maxValue: 18288000    # 20 inches maximum
    metadata:
      category: layout
      priority: medium
      version: "1.0.0"
      
  - # Calculated variable with dependencies
    id: title_font_size
    type: dimension
    scope: shape
    xpath: "//a:r/a:rPr/@sz"
    dependencies: [base_font_size, title_scale_factor]
    ooxml:
      namespace: "http://schemas.openxmlformats.org/drawingml/2006/main"
      element: rPr
      attribute: sz
      valueType: calculated
    defaultValue: "4400"     # 22pt in half-points
    description: "Calculated title font size based on base size and scale"
    metadata:
      category: typography
      priority: medium
      version: "1.0.0"