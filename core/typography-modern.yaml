# StyleStack Modern Typography Configuration
# Inspired by Open XML PowerTools approach with advanced kerning and text styling
# 
# This YAML file defines comprehensive typography transforms for OOXML documents
# Supporting PowerPoint (POTX), Word (DOTX), and Excel (XLTX) templates

$schema: "../schemas/stylestack-config.yaml"

metadata:
  name: "Modern Typography Engine"
  version: "1.0.0" 
  description: "Advanced typography configuration with modern kerning, OpenType features, and professional text styling"
  inspired_by: "Open XML PowerTools methodology"
  target_formats: ["potx", "dotx", "xltx"]

# ============================================================================
# FONT SYSTEM - Modern Typography Stack
# ============================================================================

fonts:
  # Primary system fonts with OpenType feature support
  primary:
    display:
      family: "Inter"
      fallbacks: ["SF Pro Display", "Segoe UI Variable", "system-ui", "Arial"]
      weights: [100, 200, 300, 400, 500, 600, 700, 800, 900]
      opentype_features:
        - kern: true     # Kerning
        - liga: true     # Ligatures  
        - calt: true     # Contextual alternates
        - ss01: true     # Stylistic set 1 (rounded dots)
        - tnum: false    # Tabular numbers (disable for display)
        - case: true     # All caps alternates
      
    body:
      family: "Inter"
      fallbacks: ["SF Pro Text", "Segoe UI", "system-ui", "Arial"]
      weights: [300, 400, 500, 600, 700]
      opentype_features:
        - kern: true     # Essential kerning
        - liga: true     # Standard ligatures
        - calt: true     # Contextual alternates
        - tnum: true     # Tabular numbers for body text
        - onum: false    # Oldstyle numbers (modern preference)
        
    monospace:
      family: "JetBrains Mono"
      fallbacks: ["SF Mono", "Consolas", "Monaco", "Courier New"]
      weights: [200, 300, 400, 500, 600, 700, 800]
      opentype_features:
        - kern: true     # Monospace kerning
        - liga: true     # Code ligatures (->==, >=, etc)
        - calt: true     # Contextual code ligatures
        - zero: true     # Slashed zero
        - ss02: true     # Alternative @ symbol

# ============================================================================
# ADVANCED KERNING CONFIGURATION  
# ============================================================================

kerning:
  # Global kerning rules inspired by professional typography
  global:
    enabled: true
    method: "optical"    # optical | metric | manual
    strength: 0.02       # Subtle adjustment (2% of em)
    
  # Specific character pair kerning (in em units)
  pairs:
    # Critical pairs for professional appearance
    "AV": -0.08   # Significant negative kerning
    "AW": -0.06   # Moderate negative kerning  
    "AY": -0.08   # Significant negative kerning
    "AT": -0.04   # Light negative kerning
    "VA": -0.08   # Mirror of AV
    "WA": -0.06   # Mirror of AW
    "YA": -0.08   # Mirror of AY
    "TA": -0.04   # Mirror of AT
    
    # Punctuation kerning
    "T,": -0.06   # T followed by comma
    "T.": -0.06   # T followed by period
    "P,": -0.04   # P followed by comma
    "P.": -0.04   # P followed by period
    "F,": -0.04   # F followed by comma
    "F.": -0.04   # F followed by period
    
    # Quote kerning for professional look
    ""A": -0.03   # Opening quote before A
    ""T": -0.02   # Opening quote before T
    "A"": -0.03   # A before closing quote
    "T"": -0.02   # T before closing quote

  # Size-specific kerning adjustments
  size_scaling:
    small_text:      # < 12pt
      scale: 1.2     # Increase kerning for legibility
    body_text:       # 12-18pt  
      scale: 1.0     # Standard kerning
    display_text:    # > 18pt
      scale: 0.8     # Reduce kerning for tighter look

# ============================================================================
# TEXT SPACING & RHYTHM
# ============================================================================

spacing:
  # Vertical rhythm system
  baseline_grid: 6pt   # 6-point baseline grid
  
  # Leading (line-height) calculations
  leading:
    method: "proportional"    # proportional | absolute | golden_ratio
    ratios:
      display: 1.2     # Tight leading for headlines
      body: 1.5        # Comfortable reading
      caption: 1.4     # Balanced for small text
      
  # Paragraph spacing
  paragraphs:
    space_before: "0.5em"
    space_after: "0.75em"
    first_line_indent: "0em"      # Modern preference: no indent
    widow_control: true
    orphan_control: true
    
  # Word and letter spacing
  tracking:
    # Letter-spacing for different contexts
    display_tight: "-0.02em"     # -2% for large headings
    display_normal: "-0.01em"    # -1% for headings  
    body_normal: "0em"           # No tracking for body
    body_loose: "0.01em"         # +1% for dense text
    all_caps: "0.08em"           # +8% for ALL CAPS
    small_caps: "0.05em"         # +5% for small caps

# ============================================================================
# TYPOGRAPHY SCALES & HIERARCHIES
# ============================================================================

type_scale:
  # Modern typographic scale (1.250 - Major Third)
  scale_ratio: 1.250
  base_size: 16pt
  
  # Generated sizes
  sizes:
    xs: 10.24pt      # -3 steps
    sm: 12.8pt       # -2 steps  
    base: 16pt       # Base size
    lg: 20pt         # +1 step
    xl: 25pt         # +2 steps
    "2xl": 31.25pt   # +3 steps
    "3xl": 39.06pt   # +4 steps
    "4xl": 48.83pt   # +5 steps
    "5xl": 61.04pt   # +6 steps

  # Semantic mapping
  semantic:
    body: "base"         # 16pt
    caption: "sm"        # 12.8pt
    footnote: "xs"       # 10.24pt
    subhead: "lg"        # 20pt
    headline: "2xl"      # 31.25pt
    display: "4xl"       # 48.83pt
    hero: "5xl"          # 61.04pt

# ============================================================================
# OPENTYPE FEATURES & ADVANCED TYPOGRAPHY
# ============================================================================

opentype:
  # Feature tags (OpenType standard)
  global_features:
    kern: true           # Kerning
    liga: true           # Standard ligatures
    clig: true           # Contextual ligatures
    dlig: false          # Discretionary ligatures (off by default)
    hlig: false          # Historical ligatures (off by default)
    
  # Numeric features
  numbers:
    default: "proportional_lining"    # pnum + lnum
    tabular_contexts: ["tables", "code", "financial"]
    oldstyle_contexts: ["body_text", "captions"]
    
  # Character variants
  stylistic_sets:
    ss01: false          # Rounded dots in Inter
    ss02: false          # Alternative @ symbol  
    ss03: false          # Curved r
    
  # Case-sensitive forms
  case_sensitive:
    enabled: true
    contexts: ["all_caps", "small_caps", "acronyms"]

# ============================================================================
# DOCUMENT-SPECIFIC CONFIGURATIONS
# ============================================================================

# PowerPoint (POTX) specific typography
powerpoint:
  slide_masters:
    title_slide:
      title:
        font: "{fonts.primary.display}"
        size: "{type_scale.sizes.4xl}"
        weight: 700
        tracking: "{spacing.tracking.display_tight}"
        leading: "{spacing.leading.ratios.display}"
        
      subtitle:
        font: "{fonts.primary.body}"
        size: "{type_scale.sizes.xl}"
        weight: 400
        tracking: "{spacing.tracking.body_normal}"
        leading: "{spacing.leading.ratios.body}"
        
    content_slide:
      title:
        font: "{fonts.primary.display}"
        size: "{type_scale.sizes.2xl}"
        weight: 600
        tracking: "{spacing.tracking.display_normal}"
        
      body:
        font: "{fonts.primary.body}"
        size: "{type_scale.sizes.base}"
        weight: 400
        tracking: "{spacing.tracking.body_normal}"
        leading: "{spacing.leading.ratios.body}"
        
      bullets:
        indent: "1em"
        spacing: "0.25em"
        hierarchy_scaling: 0.9    # Each level 90% of parent

# Word (DOTX) specific typography  
word:
  styles:
    normal:
      font: "{fonts.primary.body}"
      size: "{type_scale.sizes.base}"
      weight: 400
      leading: "{spacing.leading.ratios.body}"
      paragraph_spacing:
        before: "{spacing.paragraphs.space_before}"
        after: "{spacing.paragraphs.space_after}"
        
    heading_1:
      font: "{fonts.primary.display}"
      size: "{type_scale.sizes.3xl}"
      weight: 700
      tracking: "{spacing.tracking.display_tight}"
      leading: "{spacing.leading.ratios.display}"
      space_before: "1.5em"
      space_after: "0.5em"
      
    heading_2:
      font: "{fonts.primary.display}"
      size: "{type_scale.sizes.2xl}"
      weight: 600
      tracking: "{spacing.tracking.display_normal}"
      
    heading_3:
      font: "{fonts.primary.display}"
      size: "{type_scale.sizes.xl}"
      weight: 600
      
    quote:
      font: "{fonts.primary.body}"
      size: "{type_scale.sizes.lg}"
      style: "italic"
      tracking: "{spacing.tracking.body_loose}"
      indent: "2em"
      
    code:
      font: "{fonts.monospace}"
      size: "{type_scale.sizes.sm}"
      background: "#f8f9fa"
      padding: "0.2em 0.4em"

# Excel (XLTX) specific typography
excel:
  cell_styles:
    normal:
      font: "{fonts.primary.body}"
      size: 11pt           # Excel standard
      number_format: "proportional_lining"
      
    header:
      font: "{fonts.primary.display}"
      size: 12pt
      weight: 600
      
    data:
      font: "{fonts.primary.body}"
      size: 11pt
      number_format: "tabular_lining"   # Numbers align in columns
      
    currency:
      font: "{fonts.primary.body}"
      size: 11pt
      number_format: "tabular_lining"
      decimal_places: 2

# ============================================================================
# ACCESSIBILITY & INTERNATIONALIZATION
# ============================================================================

accessibility:
  # WCAG 2.2 compliance
  contrast:
    minimum_ratio: 4.5      # AA standard
    preferred_ratio: 7.0    # AAA standard
    
  # Reading comfort
  line_length:
    min_characters: 45
    max_characters: 75
    optimal_characters: 65
    
  # Dyslexia-friendly settings
  dyslexia_support:
    increased_spacing: 1.2
    no_justified_text: true
    avoid_italics_in_body: true

# Language-specific adjustments
i18n:
  # CJK (Chinese, Japanese, Korean) support
  cjk:
    fonts:
      primary: "Source Han Sans"
      fallback: "Arial Unicode MS"
    line_height: 1.7         # Increased for character complexity
    letter_spacing: "0.05em" # Slight tracking for clarity
    
  # Arabic script support
  arabic:
    fonts:
      primary: "Noto Sans Arabic"
      fallback: "Arial"
    direction: "rtl"
    line_height: 1.6
    
  # European languages with diacritics
  european:
    increased_line_height: 1.6   # Accommodate accents

# ============================================================================
# OOXML TRANSFORMATION RULES
# ============================================================================

# Target OOXML elements for transformation
ooxml_targets:
  # PowerPoint transformations
  presentation:
    slide_masters:
      - file: "ppt/slideMasters/slideMaster1.xml"
        transforms:
          - xpath: "//a:latin/@typeface"
            value: "{fonts.primary.display.family}"
            
          - xpath: "//a:defRPr/@sz"
            value: "{type_scale.base_size_twentieths}"
            description: "Font size in twentieths of a point"
            
          - xpath: "//a:defRPr/@kern"
            value: "{kerning.global.strength_twentieths}"
            description: "Kerning in twentieths of a point"
            
    theme:
      - file: "ppt/theme/theme1.xml"
        transforms:
          - xpath: "//a:majorFont/a:latin/@typeface"
            value: "{fonts.primary.display.family}"
            
          - xpath: "//a:minorFont/a:latin/@typeface"
            value: "{fonts.primary.body.family}"

  # Word transformations
  document:
    styles:
      - file: "word/styles.xml"
        transforms:
          - xpath: "//w:rFonts/@w:ascii"
            value: "{fonts.primary.body.family}"
            
          - xpath: "//w:sz/@w:val"
            value: "{type_scale.base_size_half_points}"
            description: "Font size in half-points"
            
          - xpath: "//w:spacing/@w:val"
            value: "{spacing.leading.body_twips}"
            description: "Line spacing in twips"

# ============================================================================
# PERFORMANCE & OPTIMIZATION
# ============================================================================

optimization:
  # Font subsetting for smaller file sizes
  font_subsetting:
    enabled: true
    include_unicode_ranges:
      - "U+0020-007F"    # Basic Latin
      - "U+00A0-00FF"    # Latin-1 Supplement
      - "U+0100-017F"    # Latin Extended-A
      
  # Kerning optimization
  kerning_optimization:
    skip_pairs_under: 0.01    # Skip kerning < 1% of em
    combine_similar_pairs: true
    
  # Feature detection
  fallback_strategy:
    no_opentype: "disable_advanced_features"
    old_office: "use_basic_kerning_only"
    web_fonts: "progressive_enhancement"

# ============================================================================
# VALIDATION & QUALITY CONTROL
# ============================================================================

validation:
  # Typography quality checks
  checks:
    - name: "font_availability"
      description: "Ensure primary fonts are available"
      critical: true
      
    - name: "kerning_pairs_valid"
      description: "Validate kerning pair syntax"
      critical: true
      
    - name: "accessibility_compliance"
      description: "Check WCAG contrast ratios"
      critical: false
      
    - name: "character_support"
      description: "Verify Unicode coverage"
      critical: false

  # Output validation
  ooxml_validation:
    schema_compliance: true
    relationship_integrity: true
    font_embedding_check: true

# ============================================================================
# BUILD INTEGRATION
# ============================================================================

build_config:
  # Integration with build.py
  preprocessing:
    - calculate_twentieths_values    # Convert pt to twentieths
    - calculate_twips_values        # Convert to twips for Word
    - resolve_font_fallbacks        # Handle missing fonts
    - validate_unicode_coverage     # Check character support
    
  postprocessing:
    - embed_fonts_if_requested
    - optimize_kerning_tables
    - validate_output_quality
    - generate_typography_report

# Token calculations for OOXML (computed values)
computed_values:
  type_scale:
    base_size_twentieths: 320      # 16pt * 20
    base_size_half_points: 32      # 16pt * 2
    
  spacing:
    leading:
      body_twips: 360              # 1.5 * 16pt * 15 twips/pt
      
  kerning:
    global:
      strength_twentieths: 6.4     # 0.02em * 16pt * 20