{
  "$schema": "../schemas/patch.schema.json",
  "metadata": {
    "name": "Modern Typography Patches",
    "version": "1.0.0",
    "description": "Advanced typography patches for professional document templates",
    "applies_to": [
      "potx",
      "dotx",
      "xltx"
    ],
    "requires_tokens": [
      "typography-modern.json",
      "colors.json"
    ]
  },
  "targets": [
    {
      "file": "ppt/theme/theme1.xml",
      "ns": {
        "a": "http://schemas.openxmlformats.org/drawingml/2006/main"
      },
      "strict": true,
      "ops": [
        {
          "set": {
            "xpath": "//a:fontScheme/a:majorFont/a:latin/@typeface",
            "value": "{tokens.fonts.primary.display.family}"
          }
        },
        {
          "set": {
            "xpath": "//a:fontScheme/a:minorFont/a:latin/@typeface",
            "value": "{tokens.fonts.primary.body.family}"
          }
        },
        {
          "set": {
            "xpath": "//a:fontScheme/a:majorFont/a:cs/@typeface",
            "value": "{tokens.fonts.primary.display.family}"
          }
        },
        {
          "set": {
            "xpath": "//a:fontScheme/a:minorFont/a:cs/@typeface",
            "value": "{tokens.fonts.primary.body.family}"
          }
        }
      ]
    },
    {
      "file": "ppt/slideMasters/slideMaster1.xml",
      "ns": {
        "a": "http://schemas.openxmlformats.org/drawingml/2006/main",
        "p": "http://schemas.openxmlformats.org/presentationml/2006/main"
      },
      "ops": [
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='title']/p:txBody/a:lstStyle/a:lvl1pPr/a:defRPr/@sz",
            "value": "{tokens.computed_values.type_scale.display_size_twentieths}"
          }
        },
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='title']/p:txBody/a:lstStyle/a:lvl1pPr/a:defRPr/@kern",
            "value": "{tokens.computed_values.kerning.display_kern_twentieths}"
          }
        },
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='title']/p:txBody/a:lstStyle/a:lvl1pPr/a:defRPr/@kern",
            "value": "1200",
            "description": "Enable kerning (1200 = enabled in OOXML)"
          }
        },
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='body']/p:txBody/a:lstStyle/a:lvl1pPr/a:defRPr/@sz",
            "value": "{tokens.computed_values.type_scale.body_size_twentieths}"
          }
        },
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='body']/p:txBody/a:lstStyle/a:lvl1pPr/@spcBef",
            "value": "{tokens.computed_values.spacing.paragraph_before_points}"
          }
        },
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='body']/p:txBody/a:lstStyle/a:lvl1pPr/@spcAft",
            "value": "{tokens.computed_values.spacing.paragraph_after_points}"
          }
        },
        {
          "insert": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='title']/p:txBody/a:lstStyle/a:lvl1pPr/a:defRPr",
            "position": "last",
            "xml": "<a:latin typeface=\"{tokens.fonts.primary.display.family}\" \n         pitchFamily=\"34\" charset=\"0\"/>\n<a:hlinkClick tooltip=\"Modern Typography: {tokens.fonts.primary.display.family} with kerning\"/>\n"
          }
        }
      ]
    },
    {
      "file": "ppt/slideLayouts/slideLayout1.xml",
      "ns": {
        "a": "http://schemas.openxmlformats.org/drawingml/2006/main",
        "p": "http://schemas.openxmlformats.org/presentationml/2006/main"
      },
      "ops": [
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='subTitle']/p:txBody/a:lstStyle/a:lvl1pPr/a:defRPr/@sz",
            "value": "{tokens.computed_values.type_scale.subtitle_size_twentieths}"
          }
        },
        {
          "set": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='subTitle']/p:txBody/a:lstStyle/a:lvl1pPr/@lnSpc",
            "value": "{tokens.computed_values.spacing.leading.subtitle_percentage}"
          }
        }
      ]
    },
    {
      "file": "word/styles.xml",
      "ns": {
        "w": "http://schemas.openxmlformats.org/wordprocessingml/2006/main"
      },
      "strict": true,
      "ops": [
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Normal']/w:rPr/w:rFonts/@w:ascii",
            "value": "{tokens.fonts.primary.body.family}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Normal']/w:rPr/w:rFonts/@w:hAnsi",
            "value": "{tokens.fonts.primary.body.family}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Normal']/w:rPr/w:sz/@w:val",
            "value": "{tokens.computed_values.type_scale.base_size_half_points}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Normal']/w:pPr/w:spacing/@w:line",
            "value": "{tokens.computed_values.spacing.leading.body_twips}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Normal']/w:pPr/w:spacing/@w:before",
            "value": "{tokens.computed_values.spacing.paragraph_before_twips}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Normal']/w:pPr/w:spacing/@w:after",
            "value": "{tokens.computed_values.spacing.paragraph_after_twips}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Heading1']/w:rPr/w:rFonts/@w:ascii",
            "value": "{tokens.fonts.primary.display.family}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Heading1']/w:rPr/w:sz/@w:val",
            "value": "{tokens.computed_values.type_scale.heading1_size_half_points}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Heading1']/w:rPr/w:b/@w:val",
            "value": "1"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Heading1']/w:rPr/w:kern/@w:val",
            "value": "{tokens.computed_values.kerning.heading_kern_half_points}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Heading2']/w:rPr/w:rFonts/@w:ascii",
            "value": "{tokens.fonts.primary.display.family}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Heading2']/w:rPr/w:sz/@w:val",
            "value": "{tokens.computed_values.type_scale.heading2_size_half_points}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Quote']/w:rPr/w:i/@w:val",
            "value": "1"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Quote']/w:rPr/w:sz/@w:val",
            "value": "{tokens.computed_values.type_scale.quote_size_half_points}"
          }
        },
        {
          "set": {
            "xpath": "//w:style[@w:styleId='Quote']/w:rPr/w:spacing/@w:val",
            "value": "{tokens.computed_values.spacing.tracking.quote_twips}"
          }
        }
      ]
    },
    {
      "file": "word/theme/theme1.xml",
      "ns": {
        "a": "http://schemas.openxmlformats.org/drawingml/2006/main"
      },
      "ops": [
        {
          "set": {
            "xpath": "//a:fontScheme/a:majorFont/a:latin/@typeface",
            "value": "{tokens.fonts.primary.display.family}"
          }
        },
        {
          "set": {
            "xpath": "//a:fontScheme/a:minorFont/a:latin/@typeface",
            "value": "{tokens.fonts.primary.body.family}"
          }
        }
      ]
    },
    {
      "file": "xl/styles.xml",
      "ns": {
        "s": "http://schemas.openxmlformats.org/spreadsheetml/2006/main"
      },
      "ops": [
        {
          "set": {
            "xpath": "//s:fonts/s:font[1]/s:name/@val",
            "value": "{tokens.fonts.primary.body.family}"
          }
        },
        {
          "set": {
            "xpath": "//s:fonts/s:font[1]/s:sz/@val",
            "value": "{tokens.computed_values.type_scale.excel_base_size_points}"
          }
        },
        {
          "set": {
            "xpath": "//s:fonts/s:font[2]/s:name/@val",
            "value": "{tokens.fonts.primary.display.family}"
          }
        },
        {
          "set": {
            "xpath": "//s:fonts/s:font[2]/s:sz/@val",
            "value": "{tokens.computed_values.type_scale.excel_header_size_points}"
          }
        },
        {
          "set": {
            "xpath": "//s:fonts/s:font[2]/s:b/@val",
            "value": "1"
          }
        }
      ]
    },
    {
      "file": "xl/theme/theme1.xml",
      "ns": {
        "a": "http://schemas.openxmlformats.org/drawingml/2006/main"
      },
      "ops": [
        {
          "set": {
            "xpath": "//a:fontScheme/a:majorFont/a:latin/@typeface",
            "value": "{tokens.fonts.primary.display.family}"
          }
        },
        {
          "set": {
            "xpath": "//a:fontScheme/a:minorFont/a:latin/@typeface",
            "value": "{tokens.fonts.primary.body.family}"
          }
        }
      ]
    },
    {
      "file": "ppt/slideMasters/slideMaster1.xml",
      "ns": {
        "a": "http://schemas.openxmlformats.org/drawingml/2006/main",
        "p": "http://schemas.openxmlformats.org/presentationml/2006/main"
      },
      "ops": [
        {
          "insert": {
            "xpath": "//p:sp[p:nvSpPr/p:nvPr/p:ph/@type='title']/p:txBody/a:lstStyle/a:lvl1pPr/a:defRPr",
            "position": "last",
            "xml": "<a:extLst>\n  <a:ext uri=\"{OpenType-Features}\">\n    <opentype:features xmlns:opentype=\"http://schemas.microsoft.com/office/opentype/2014/main\">\n      <opentype:feature tag=\"kern\" value=\"1\"/>\n      <opentype:feature tag=\"liga\" value=\"1\"/>\n      <opentype:feature tag=\"calt\" value=\"1\"/>\n    </opentype:features>\n  </a:ext>\n</a:extLst>\n"
          }
        }
      ]
    },
    {
      "relsAdd": {
        "file": "ppt/_rels/presentation.xml.rels",
        "items": [
          {
            "id": "rIdFontInter",
            "type": "http://schemas.microsoft.com/office/2007/relationships/font",
            "target": "fonts/Inter-Regular.ttf"
          },
          {
            "id": "rIdFontInterBold",
            "type": "http://schemas.microsoft.com/office/2007/relationships/font",
            "target": "fonts/Inter-Bold.ttf"
          }
        ]
      }
    }
  ],
  "computed_tokens": {
    "type_scale": {
      "display_size_twentieths": 976,
      "subtitle_size_twentieths": 640,
      "body_size_twentieths": 320,
      "base_size_half_points": 32,
      "heading1_size_half_points": 78,
      "heading2_size_half_points": 62,
      "quote_size_half_points": 40,
      "excel_base_size_points": 11,
      "excel_header_size_points": 12
    },
    "kerning": {
      "display_kern_twentieths": -32,
      "heading_kern_half_points": 24
    },
    "spacing": {
      "leading": {
        "body_twips": 360
      },
      "paragraph_before_points": 8,
      "paragraph_after_points": 12,
      "paragraph_before_twips": 160,
      "paragraph_after_twips": 240,
      "tracking": {
        "quote_twips": 20
      }
    }
  },
  "validation": {
    "required_elements": [
      "ppt/theme/theme1.xml://a:fontScheme/a:majorFont/a:latin",
      "ppt/theme/theme1.xml://a:fontScheme/a:minorFont/a:latin",
      "word/styles.xml://w:style[@w:styleId='Normal']/w:rPr/w:rFonts"
    ],
    "typography_checks": [
      {
        "name": "font_consistency",
        "description": "Ensure consistent font usage across templates"
      },
      {
        "name": "size_hierarchy",
        "description": "Validate typographic scale hierarchy"
      },
      {
        "name": "kerning_values",
        "description": "Check kerning values are within reasonable bounds"
      }
    ]
  }
}